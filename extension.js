const vscode=require('vscode');function activate(context){const lineDecorationType=vscode.window.createTextEditorDecorationType({before:{color:'#888',fontWeight:'bold'},isWholeLine:!0});const previousLineNumberStyles=new Map();function hideNativeLineNumbers(editor){if(!editor)return;const uriKey=editor.document.uri.toString();previousLineNumberStyles.has(uriKey)||previousLineNumberStyles.set(uriKey,editor.options.lineNumbers);if(editor.options.lineNumbers!==vscode.TextEditorLineNumbersStyle.Off){editor.options={...editor.options,lineNumbers:vscode.TextEditorLineNumbersStyle.Off}}}function updateDecorations(editor=vscode.window.activeTextEditor){if(!editor)return;hideNativeLineNumbers(editor);const activeLine=editor.selection.active.line,activeColumn=editor.selection.active.character+1,maxDigits=editor.document.lineCount.toString().length,activeColumnDigits=Math.max(2,activeColumn.toString().length),labelWidth=maxDigits+1+activeColumnDigits,visibleLines=new Set;editor.visibleRanges.forEach(range=>{const start=Math.max(range.start.line,0),end=Math.min(range.end.line,editor.document.lineCount-1);for(let line=start;line<=end;line++)visibleLines.add(line)});0===visibleLines.size&&editor.document.lineCount>0&&visibleLines.add(editor.selection.active.line);const decorations=Array.from(visibleLines).sort((a,b)=>a-b).map(line=>{const lineNumber=line+1,isActive=line===activeLine,label=isActive?`${lineNumber}-${activeColumn}`:''.padStart(labelWidth,' '),decorationCss=`none;display:inline-block;width:${labelWidth+1}ch;text-align:right;padding-right:1ch;`;return{range:new vscode.Range(line,0,line,0),renderOptions:{before:{contentText:label,textDecoration:decorationCss}}}});editor.setDecorations(lineDecorationType,decorations)}function refreshAllVisibleEditors(){vscode.window.visibleTextEditors.forEach(updateDecorations)}context.subscriptions.push(lineDecorationType,vscode.window.onDidChangeTextEditorSelection(event=>updateDecorations(event.textEditor)),vscode.window.onDidChangeActiveTextEditor(updateDecorations),vscode.window.onDidChangeTextEditorVisibleRanges(event=>updateDecorations(event.textEditor)),vscode.window.onDidChangeVisibleTextEditors(refreshAllVisibleEditors),vscode.workspace.onDidChangeTextDocument(event=>{vscode.window.visibleTextEditors.filter(editor=>editor.document===event.document).forEach(updateDecorations)})),refreshAllVisibleEditors(),context.subscriptions.push({dispose(){vscode.window.visibleTextEditors.forEach(editor=>{const uriKey=editor.document.uri.toString(),previousStyle=previousLineNumberStyles.get(uriKey);previousStyle!==undefined&&(editor.options={...editor.options,lineNumbers:previousStyle})})}})}function deactivate(){}module.exports={activate,deactivate};
